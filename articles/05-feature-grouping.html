<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Step 5: Feature Grouping Visualization • xcmsVis</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="05-feature-grouping_files/libs/quarto-html/popper.min.js"></script><script src="05-feature-grouping_files/libs/quarto-html/tippy.umd.min.js"></script><link href="05-feature-grouping_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="05-feature-grouping_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="05-feature-grouping_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="05-feature-grouping_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="05-feature-grouping_files/libs/plotly-binding-4.11.0/plotly.js"></script><script src="05-feature-grouping_files/libs/typedarray-0.1/typedarray.min.js"></script><link href="05-feature-grouping_files/libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="05-feature-grouping_files/libs/crosstalk-1.2.2/js/crosstalk.min.js"></script><link href="05-feature-grouping_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="05-feature-grouping_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Step 5: Feature Grouping Visualization">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">xcmsVis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.22</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><h6 class="dropdown-header" data-toc-skip>---------- XCMS Workflow ----------</h6></li>
    <li><a class="dropdown-item" href="../articles/01-raw-data-visualization.html">Step 1: Raw Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/02-peak-detection.html">Step 2: Peak Detection Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/03-peak-correspondence.html">Step 3: Peak Correspondence Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/04-retention-time-alignment.html">Step 4: Retention Time Alignment Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/05-feature-grouping.html">Step 5: Feature Grouping Visualization</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stanstrup/xcmsVis" aria-label="GitHub repository"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Step 5: Feature Grouping Visualization</h1>

      <p class="author">xcmsVis Package</p>
      <p class="date">2025-11-10</p>

      <small class="dont-index">Source: <a href="https://github.com/stanstrup/xcmsVis/blob/main/vignettes/05-feature-grouping.qmd" class="external-link"><code>vignettes/05-feature-grouping.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="section level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette covers the <strong>final step</strong> in the XCMS metabolomics workflow: <strong>feature grouping</strong>. After retention time alignment, these functions help you:</p>
<ul>
<li>Visualize relationships between features</li>
<li>Identify isotopes, adducts, and fragments</li>
<li>Assess feature annotation quality</li>
<li>Create publication-ready feature network plots</li>
</ul>
<section class="level2"><h3 id="xcms-workflow-context">XCMS Workflow Context<a class="anchor" aria-label="anchor" href="#xcms-workflow-context"></a>
</h3>
<pre><code>┌─────────────────────────────────────┐
│ 1. Raw Data Visualization           │
│ 2. Peak Detection                   │
│ 3. Peak Correspondence               │
│ 4. Retention Time Alignment          │
├─────────────────────────────────────┤
│ 5. FEATURE GROUPING      ← YOU ARE HERE
└─────────────────────────────────────┘</code></pre>
</section><section class="level2"><h3 id="what-is-feature-grouping">What is Feature Grouping?<a class="anchor" aria-label="anchor" href="#what-is-feature-grouping"></a>
</h3>
<p>Feature grouping identifies features that likely represent the same compound. After feature detection and correspondence, <code><a href="https://rdrr.io/pkg/MsFeatures/man/groupFeatures.html" class="external-link">groupFeatures()</a></code> connects features that may be:</p>
<ul>
<li>
<strong>Isotopes</strong>: M+1, M+2 isotopic peaks</li>
<li>
<strong>Adducts</strong>: [M+H]+, [M+Na]+, [M+K]+, etc.</li>
<li>
<strong>Fragments</strong>: In-source fragmentation products</li>
<li>
<strong>Correlated features</strong>: Compounds with similar abundance patterns</li>
</ul>
<p>The <code><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups()</a></code> function visualizes these relationships by plotting features connected by lines within each group across retention time and m/z dimensions.</p>
</section><section class="level2"><h3 id="functions-covered">Functions Covered<a class="anchor" aria-label="anchor" href="#functions-covered"></a>
</h3>
<ul>
<li>
<strong><code><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups()</a></code></strong>: Visualize feature group relationships in RT/m/z space</li>
</ul></section></section><section class="section level2"><h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sneumann/xcms" class="external-link">xcms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stanstrup.github.io/xcmsVis">xcmsVis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsExperiment" class="external-link">MsExperiment</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsFeatures" class="external-link">MsFeatures</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Bioconductor/BiocParallel" class="external-link">BiocParallel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Configure for serial processing</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="load-and-process-data">Load and Process Data<a class="anchor" aria-label="anchor" href="#load-and-process-data"></a>
</h2>
<p>Feature grouping requires a complete XCMS workflow: peak detection, correspondence, retention time alignment, re-correspondence, and then feature grouping.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load example data</span></span>
<span><span class="va">cdf_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"cdf"</span>, package <span class="op">=</span> <span class="st">"faahKO"</span><span class="op">)</span>,</span>
<span>                 recursive <span class="op">=</span> <span class="cn">TRUE</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create XcmsExperiment</span></span>
<span><span class="va">xdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/readMsExperiment.html" class="external-link">readMsExperiment</a></span><span class="op">(</span>spectraFiles <span class="op">=</span> <span class="va">cdf_files</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add sample metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">cdf_files</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">$</span><span class="va">sample_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"KO"</span>, <span class="st">"KO"</span>, <span class="st">"WT"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Loaded"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">fileNames</span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">)</span>, <span class="st">"files\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loaded 3 files</span></span></code></pre></div>
</div>
<section class="level2"><h3 id="complete-xcms-workflow">Complete XCMS Workflow<a class="anchor" aria-label="anchor" href="#complete-xcms-workflow"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Peak detection</span></span>
<span><span class="va">cwp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks-centWave.html" class="external-link">CentWaveParam</a></span><span class="op">(</span>peakwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">80</span><span class="op">)</span>, ppm <span class="op">=</span> <span class="fl">25</span>, noise <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">xdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">xdata</span>, param <span class="op">=</span> <span class="va">cwp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Detected"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">)</span>, <span class="st">"peaks\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Detected 3385 peaks</span></span>
<span></span>
<span><span class="co"># 2. Peak grouping (correspondence)</span></span>
<span><span class="va">pdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">PeakDensityParam</a></span><span class="op">(</span>sampleGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">$</span><span class="va">sample_group</span>,</span>
<span>                        minFraction <span class="op">=</span> <span class="fl">0.5</span>, bw <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">xdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">groupChromPeaks</a></span><span class="op">(</span><span class="va">xdata</span>, param <span class="op">=</span> <span class="va">pdp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Grouped into"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">featureDefinitions</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">)</span>, <span class="st">"features\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Grouped into 1934 features</span></span>
<span></span>
<span><span class="co"># 3. Retention time alignment</span></span>
<span><span class="va">xdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">adjustRtime</a></span><span class="op">(</span><span class="va">xdata</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">ObiwarpParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Re-group after alignment</span></span>
<span><span class="va">xdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">groupChromPeaks</a></span><span class="op">(</span><span class="va">xdata</span>, param <span class="op">=</span> <span class="va">pdp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"After alignment:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">featureDefinitions</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">)</span>, <span class="st">"features\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; After alignment: 1934 features</span></span>
<span></span>
<span><span class="co"># 5. Group features (identify related features)</span></span>
<span><span class="va">xdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/groupFeatures.html" class="external-link">groupFeatures</a></span><span class="op">(</span><span class="va">xdata</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/groupFeatures-similar-rtime.html" class="external-link">SimilarRtimeParam</a></span><span class="op">(</span>diffRt <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Identified"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/featureGroups.html" class="external-link">featureGroups</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="st">"feature groups\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Identified 604 feature groups</span></span></code></pre></div>
</div>
</section></section><section class="section level2"><h2 id="basic-feature-group-visualization">Basic Feature Group Visualization<a class="anchor" aria-label="anchor" href="#basic-feature-group-visualization"></a>
</h2>
<p>The default plot shows all feature groups, with features connected by lines within each group:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="05-feature-grouping_files/figure-html/basic_plot-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<section class="level2"><h3 id="interpretation">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation"></a>
</h3>
<ul>
<li>
<strong>Points</strong>: Individual features (at their median RT and m/z across samples)</li>
<li>
<strong>Lines</strong>: Connect features within the same group</li>
<li>
<strong>Groups</strong>: Represent features likely from the same compound (isotopes, adducts, etc.)</li>
</ul></section></section><section class="section level2"><h2 id="filtering-to-specific-feature-groups">Filtering to Specific Feature Groups<a class="anchor" aria-label="anchor" href="#filtering-to-specific-feature-groups"></a>
</h2>
<p>You can visualize specific feature groups of interest:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get all feature group IDs</span></span>
<span><span class="va">all_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/featureGroups.html" class="external-link">featureGroups</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Feature groups:"</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">all_groups</span>, <span class="fl">10</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Feature groups: FG.0001 FG.0002 FG.0003 FG.0004 FG.0005 FG.0006 FG.0007 FG.0008 FG.0009 FG.0010</span></span>
<span></span>
<span><span class="co"># Plot first 5 groups</span></span>
<span><span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span>, featureGroups <span class="op">=</span> <span class="va">all_groups</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"First 5 Feature Groups"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="05-feature-grouping_files/figure-html/specific_groups-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section><section class="section level2"><h2 id="customization">Customization<a class="anchor" aria-label="anchor" href="#customization"></a>
</h2>
<section class="level2"><h3 id="custom-styling">Custom Styling<a class="anchor" aria-label="anchor" href="#custom-styling"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get first 5 feature groups for clearer visualization</span></span>
<span><span class="va">all_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/featureGroups.html" class="external-link">featureGroups</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span>,</span>
<span>                   featureGroups <span class="op">=</span> <span class="va">all_groups</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>,</span>
<span>                   col <span class="op">=</span> <span class="st">"#E31A1C"</span>,  <span class="co"># Red color</span></span>
<span>                   pch <span class="op">=</span> <span class="fl">16</span>,          <span class="co"># Solid circles</span></span>
<span>                   xlab <span class="op">=</span> <span class="st">"Retention Time (sec)"</span>,</span>
<span>                   ylab <span class="op">=</span> <span class="st">"Mass-to-Charge Ratio (m/z)"</span>,</span>
<span>                   main <span class="op">=</span> <span class="st">"Custom Styled Feature Groups"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="05-feature-grouping_files/figure-html/custom_style-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section><section class="level2"><h3 id="different-plot-types">Different Plot Types<a class="anchor" aria-label="anchor" href="#different-plot-types"></a>
</h3>
<p>The <code>type</code> parameter controls whether to show lines, points, or both:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use subset of feature groups for clearer visualization</span></span>
<span><span class="va">fg_subset</span> <span class="op">&lt;-</span> <span class="va">all_groups</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot with lines and points (default)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span>, featureGroups <span class="op">=</span> <span class="va">fg_subset</span>, type <span class="op">=</span> <span class="st">"o"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'type = "o" (overplot - lines + points)'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot with lines only</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span>, featureGroups <span class="op">=</span> <span class="va">fg_subset</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'type = "l" (lines only)'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot with points only</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span>, featureGroups <span class="op">=</span> <span class="va">fg_subset</span>, type <span class="op">=</span> <span class="st">"p"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'type = "p" (points only)'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine plots</span></span>
<span><span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span> <span class="op">/</span> <span class="va">p3</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="05-feature-grouping_files/figure-html/plot_types-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section><section class="level2"><h3 id="zooming-to-specific-regions">Zooming to Specific Regions<a class="anchor" aria-label="anchor" href="#zooming-to-specific-regions"></a>
</h3>
<p>Use <code>xlim</code> and <code>ylim</code> to focus on specific retention time or m/z ranges:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Focus on features between 3200-3300 seconds RT and specific feature groups</span></span>
<span><span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span>,</span>
<span>                   featureGroups <span class="op">=</span> <span class="va">fg_subset</span>,</span>
<span>                   xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3200</span>, <span class="fl">3300</span><span class="op">)</span>,</span>
<span>                   ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">600</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Features in RT 3200-3300 sec, m/z 200-600"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="05-feature-grouping_files/figure-html/zoom-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section></section><section class="section level2"><h2 id="interactive-visualization">Interactive Visualization<a class="anchor" aria-label="anchor" href="#interactive-visualization"></a>
</h2>
<p>Convert to interactive plotly plot for exploration:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use subset for better interactivity</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span>, featureGroups <span class="op">=</span> <span class="va">fg_subset</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-c07b341f816c9a9c5e4d" style="width:960px;height:576px;"></div>
<script type="application/json" data-for="htmlwidget-c07b341f816c9a9c5e4d">{"x":{"data":[{"x":[2876.9670000000001,2876.9670000000001,2876.9670000000001,2876.9670000000001,null,null,2556.1509999999998,2559.2809999999999,2559.2809999999999,null,null,3141.444,3141.444,null,null,3369.9279999999999,3374.6219999999998,3373.058,3374.6219999999998,null,null,3261.9450000000002,3261.9450000000002,3261.9450000000002,3261.9450000000002,null],"y":[493.10000610351562,489.30001831054688,355.20001220703125,200.10000610351562,null,null,303.20001220703125,231.10000610351562,200.90000915527344,null,null,308.10000610351562,201.10000610351562,null,null,513.29998779296875,359.30001831054688,283,201.80000305175781,null,null,412.39999389648438,330.10000610351562,308.10000610351562,201.90000915527344,null],"text":["Retention Time: 2876.967<br />m/z: 493.1<br />Feature Group: FG.0001","Retention Time: 2876.967<br />m/z: 489.3<br />Feature Group: FG.0001","Retention Time: 2876.967<br />m/z: 355.2<br />Feature Group: FG.0001","Retention Time: 2876.967<br />m/z: 200.1<br />Feature Group: FG.0001","Retention Time:       NA<br />m/z:    NA<br />Feature Group: FG.0001",null,"Retention Time: 2556.151<br />m/z: 303.2<br />Feature Group: FG.0002","Retention Time: 2559.281<br />m/z: 231.1<br />Feature Group: FG.0002","Retention Time: 2559.281<br />m/z: 200.9<br />Feature Group: FG.0002","Retention Time:       NA<br />m/z:    NA<br />Feature Group: FG.0002",null,"Retention Time: 3141.444<br />m/z: 308.1<br />Feature Group: FG.0003","Retention Time: 3141.444<br />m/z: 201.1<br />Feature Group: FG.0003","Retention Time:       NA<br />m/z:    NA<br />Feature Group: FG.0003",null,"Retention Time: 3369.928<br />m/z: 513.3<br />Feature Group: FG.0004","Retention Time: 3374.622<br />m/z: 359.3<br />Feature Group: FG.0004","Retention Time: 3373.058<br />m/z: 283.0<br />Feature Group: FG.0004","Retention Time: 3374.622<br />m/z: 201.8<br />Feature Group: FG.0004","Retention Time:       NA<br />m/z:    NA<br />Feature Group: FG.0004",null,"Retention Time: 3261.945<br />m/z: 412.4<br />Feature Group: FG.0005","Retention Time: 3261.945<br />m/z: 330.1<br />Feature Group: FG.0005","Retention Time: 3261.945<br />m/z: 308.1<br />Feature Group: FG.0005","Retention Time: 3261.945<br />m/z: 201.9<br />Feature Group: FG.0005","Retention Time:       NA<br />m/z:    NA<br />Feature Group: FG.0005"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,0.3765)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2876.9670000000001,2876.9670000000001,2876.9670000000001,2876.9670000000001,null,2556.1509999999998,2559.2809999999999,2559.2809999999999,null,3141.444,3141.444,null,3369.9279999999999,3374.6219999999998,3373.058,3374.6219999999998,null,3261.9450000000002,3261.9450000000002,3261.9450000000002,3261.9450000000002,null],"y":[493.10000610351562,489.30001831054688,355.20001220703125,200.10000610351562,null,303.20001220703125,231.10000610351562,200.90000915527344,null,308.10000610351562,201.10000610351562,null,513.29998779296875,359.30001831054688,283,201.80000305175781,null,412.39999389648438,330.10000610351562,308.10000610351562,201.90000915527344,null],"text":["Retention Time: 2876.967<br />m/z: 493.1<br />Feature Group: FG.0001","Retention Time: 2876.967<br />m/z: 489.3<br />Feature Group: FG.0001","Retention Time: 2876.967<br />m/z: 355.2<br />Feature Group: FG.0001","Retention Time: 2876.967<br />m/z: 200.1<br />Feature Group: FG.0001","Retention Time:       NA<br />m/z:    NA<br />Feature Group: FG.0001","Retention Time: 2556.151<br />m/z: 303.2<br />Feature Group: FG.0002","Retention Time: 2559.281<br />m/z: 231.1<br />Feature Group: FG.0002","Retention Time: 2559.281<br />m/z: 200.9<br />Feature Group: FG.0002","Retention Time:       NA<br />m/z:    NA<br />Feature Group: FG.0002","Retention Time: 3141.444<br />m/z: 308.1<br />Feature Group: FG.0003","Retention Time: 3141.444<br />m/z: 201.1<br />Feature Group: FG.0003","Retention Time:       NA<br />m/z:    NA<br />Feature Group: FG.0003","Retention Time: 3369.928<br />m/z: 513.3<br />Feature Group: FG.0004","Retention Time: 3374.622<br />m/z: 359.3<br />Feature Group: FG.0004","Retention Time: 3373.058<br />m/z: 283.0<br />Feature Group: FG.0004","Retention Time: 3374.622<br />m/z: 201.8<br />Feature Group: FG.0004","Retention Time:       NA<br />m/z:    NA<br />Feature Group: FG.0004","Retention Time: 3261.945<br />m/z: 412.4<br />Feature Group: FG.0005","Retention Time: 3261.945<br />m/z: 330.1<br />Feature Group: FG.0005","Retention Time: 3261.945<br />m/z: 308.1<br />Feature Group: FG.0005","Retention Time: 3261.945<br />m/z: 201.9<br />Feature Group: FG.0005","Retention Time:       NA<br />m/z:    NA<br />Feature Group: FG.0005"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,0,0,0.3765)","opacity":1,"size":5.6692913385826778,"symbol":"x-thin-open","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,0.3765)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":40.840182648401829,"r":7.3059360730593621,"b":37.260273972602747,"l":43.105022831050235},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Feature groups","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[2515.2274499999999,3415.5455499999998],"tickmode":"array","ticktext":["2750","3000","3250"],"tickvals":[2750,3000,3250],"categoryorder":"array","categoryarray":["2750","3000","3250"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"retention time","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[184.44000701904298,528.95998687744145],"tickmode":"array","ticktext":["200","300","400","500"],"tickvals":[200,300,400,500],"categoryorder":"array","categoryarray":["200","300","400","500"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"m/z","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"rgba(255,255,255,1)","line":{"color":"rgba(51,51,51,1)","width":0,"linetype":"solid"},"yref":"paper","xref":"paper","layer":"below","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"23313a538af5":{"x":{},"y":{},"text":{},"type":"scatter"},"2331192fb823":{"x":{},"y":{},"text":{}}},"cur_data":"23313a538af5","visdat":{"23313a538af5":["function (y) ","x"],"2331192fb823":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section><section class="section level2"><h2 id="understanding-feature-groups">Understanding Feature Groups<a class="anchor" aria-label="anchor" href="#understanding-feature-groups"></a>
</h2>
<p>Feature groups represent features that are likely derived from the same compound. Common grouping parameters:</p>
<section class="level2"><h3 id="similar-retention-time">Similar Retention Time<a class="anchor" aria-label="anchor" href="#similar-retention-time"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Group features with similar retention times (likely isotopes/adducts)</span></span>
<span><span class="va">xdata_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/groupFeatures.html" class="external-link">groupFeatures</a></span><span class="op">(</span><span class="va">xdata</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/groupFeatures-similar-rtime.html" class="external-link">SimilarRtimeParam</a></span><span class="op">(</span>diffRt <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"SimilarRtimeParam (diffRt=10):"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/featureGroups.html" class="external-link">featureGroups</a></span><span class="op">(</span><span class="va">xdata_rt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="st">"groups\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; SimilarRtimeParam (diffRt=10): 609 groups</span></span>
<span></span>
<span><span class="co"># Show first 5 groups</span></span>
<span><span class="va">fg_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/featureGroups.html" class="external-link">featureGroups</a></span><span class="op">(</span><span class="va">xdata_rt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata_rt</span>, featureGroups <span class="op">=</span> <span class="va">fg_rt</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Feature Groups: Similar Retention Time (diffRt = 10 sec)"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="05-feature-grouping_files/figure-html/similar_rt-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section><section class="level2"><h3 id="abundance-correlation">Abundance Correlation<a class="anchor" aria-label="anchor" href="#abundance-correlation"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Group features with correlated abundances across samples</span></span>
<span><span class="va">xdata_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/groupFeatures.html" class="external-link">groupFeatures</a></span><span class="op">(</span><span class="va">xdata</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/groupFeatures-similar-abundance.html" class="external-link">AbundanceSimilarityParam</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"AbundanceSimilarityParam (threshold=0.7):"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/featureGroups.html" class="external-link">featureGroups</a></span><span class="op">(</span><span class="va">xdata_cor</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="st">"groups\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; AbundanceSimilarityParam (threshold=0.7): 1834 groups</span></span>
<span></span>
<span><span class="co"># Show first 5 groups</span></span>
<span><span class="va">fg_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsFeatures/man/featureGroups.html" class="external-link">featureGroups</a></span><span class="op">(</span><span class="va">xdata_cor</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata_cor</span>, featureGroups <span class="op">=</span> <span class="va">fg_cor</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Feature Groups: Abundance Correlation (threshold = 0.7)"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="05-feature-grouping_files/figure-html/correlation-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section></section><section class="section level2"><h2 id="use-cases">Use Cases<a class="anchor" aria-label="anchor" href="#use-cases"></a>
</h2>
<section class="level2"><h3 id="isotope-pattern-identification">Isotope Pattern Identification<a class="anchor" aria-label="anchor" href="#isotope-pattern-identification"></a>
</h3>
<p>Features grouped by similar RT and m/z spacing may represent isotope patterns (M, M+1, M+2).</p>
</section><section class="level2"><h3 id="adduct-identification">Adduct Identification<a class="anchor" aria-label="anchor" href="#adduct-identification"></a>
</h3>
<p>Features with similar RT but different m/z values that correlate in abundance may be different adducts of the same compound.</p>
</section><section class="level2"><h3 id="quality-control">Quality Control<a class="anchor" aria-label="anchor" href="#quality-control"></a>
</h3>
<p>Visualize feature groups to:</p>
<ul>
<li>Verify grouping parameters are appropriate</li>
<li>Identify over-grouping (too many features in one group)</li>
<li>Identify under-grouping (features that should be grouped but aren’t)</li>
</ul></section><section class="level2"><h3 id="publication-figures">Publication Figures<a class="anchor" aria-label="anchor" href="#publication-figures"></a>
</h3>
<p>Create clean, customizable figures showing compound annotation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span>, featureGroups <span class="op">=</span> <span class="va">fg_subset</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray90"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Feature Group Relationships"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Connected features represent potential isotopes, adducts, or fragments"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="05-feature-grouping_files/figure-html/publication-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section></section><section class="section level2"><h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<section class="level2"><h3 id="functions-covered-1">Functions Covered<a class="anchor" aria-label="anchor" href="#functions-covered-1"></a>
</h3>
<table class="table caption-top">
<colgroup>
<col style="width: 38%">
<col style="width: 34%">
<col style="width: 26%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Purpose</th>
<th>Input</th>
</tr></thead>
<tbody><tr class="odd">
<td><code><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups()</a></code></td>
<td>Visualize feature group relationships</td>
<td>XcmsExperiment, XCMSnExp</td>
</tr></tbody>
</table></section><section class="level2"><h3 id="use-cases-1">Use Cases<a class="anchor" aria-label="anchor" href="#use-cases-1"></a>
</h3>
<ul>
<li>
<strong>Compound annotation</strong>: Identify isotopes, adducts, and fragments</li>
<li>
<strong>Quality control</strong>: Verify feature grouping quality</li>
<li>
<strong>Method development</strong>: Optimize groupFeatures parameters</li>
<li>
<strong>Publication</strong>: Create network plots of feature relationships</li>
</ul></section><section class="level2"><h3 id="workflow-complete">Workflow Complete!<a class="anchor" aria-label="anchor" href="#workflow-complete"></a>
</h3>
<p>You’ve now completed the full XCMS visualization workflow:</p>
<pre><code>✓ 1. Raw Data Visualization
✓ 2. Peak Detection
✓ 3. Peak Correspondence
✓ 4. Retention Time Alignment
✓ 5. Feature Grouping</code></pre>
</section></section><section class="section level2"><h2 id="comparison-with-original-xcms">Comparison with Original XCMS<a class="anchor" aria-label="anchor" href="#comparison-with-original-xcms"></a>
</h2>
<div class="row">
<section class="level2 col-md-6"><h3 id="original-xcms-version">Original XCMS Version<a class="anchor" aria-label="anchor" href="#original-xcms-version"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># XCMS original (base R graphics)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/plotFeatureGroups.html" class="external-link">plotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span>, featureGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FG.0001"</span>, <span class="st">"FG.0002"</span>, <span class="st">"FG.0003"</span>, <span class="st">"FG.0004"</span>, <span class="st">"FG.0005"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="05-feature-grouping_files/figure-html/original_comparison-1.png" alt="XCMS plotFeatureGroups using base R graphics." width="480"></p>
</figure>
</div>
</div>
</div>
</section><section class="level2 col-md-6"><h3 id="xcmsvis-ggplot2-version">xcmsVis ggplot2 Version<a class="anchor" aria-label="anchor" href="#xcmsvis-ggplot2-version"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># xcmsVis version (ggplot2)</span></span>
<span><span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span>, featureGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FG.0001"</span>, <span class="st">"FG.0002"</span>, <span class="st">"FG.0003"</span>, <span class="st">"FG.0004"</span>, <span class="st">"FG.0005"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="05-feature-grouping_files/figure-html/xcmsvis_comparison-1.png" alt="ggplot2 version with clean styling and consistent API." width="480"></p>
</figure>
</div>
</div>
</div>
</section>
</div>
<div>
<blockquote>
<p><strong>API Differences</strong></p>
<p>Unlike the original XCMS <code><a href="https://rdrr.io/pkg/xcms/man/plotFeatureGroups.html" class="external-link">plotFeatureGroups()</a></code>, the ggplot2 version does not have <code>xlab</code>, <code>ylab</code>, or <code>main</code> parameters. Instead, use ggplot2’s <code><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs()</a></code> function to customize labels after plot creation:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Customize labels with labs()</span></span>
<span><span class="fu"><a href="../reference/gplotFeatureGroups.html">gplotFeatureGroups</a></span><span class="op">(</span><span class="va">xdata</span>, featureGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FG.0001"</span>, <span class="st">"FG.0002"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Retention Time (s)"</span>, y <span class="op">=</span> <span class="st">"Mass/Charge"</span>, title <span class="op">=</span> <span class="st">"My Custom Title"</span><span class="op">)</span></span></code></pre></div>
<p>This follows ggplot2 conventions and makes the API more consistent with the broader ggplot2 ecosystem.</p>
</blockquote>
</div>
</section><section class="section level2"><h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] plotly_4.11.0       patchwork_1.3.2     ggplot2_4.0.0      </span></span>
<span><span class="co">#&gt; [4] MsFeatures_1.18.0   MsExperiment_1.12.0 ProtGenerics_1.42.0</span></span>
<span><span class="co">#&gt; [7] xcmsVis_0.99.22     xcms_4.8.0          BiocParallel_1.44.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] DBI_1.2.3                   rlang_1.1.6                </span></span>
<span><span class="co">#&gt;   [3] magrittr_2.0.4              clue_0.3-66                </span></span>
<span><span class="co">#&gt;   [5] MassSpecWavelet_1.76.0      matrixStats_1.5.0          </span></span>
<span><span class="co">#&gt;   [7] compiler_4.5.2              vctrs_0.6.5                </span></span>
<span><span class="co">#&gt;   [9] reshape2_1.4.4              stringr_1.6.0              </span></span>
<span><span class="co">#&gt;  [11] pkgconfig_2.0.3             MetaboCoreUtils_1.18.0     </span></span>
<span><span class="co">#&gt;  [13] crayon_1.5.3                fastmap_1.2.0              </span></span>
<span><span class="co">#&gt;  [15] XVector_0.50.0              labeling_0.4.3             </span></span>
<span><span class="co">#&gt;  [17] rmarkdown_2.30              preprocessCore_1.72.0      </span></span>
<span><span class="co">#&gt;  [19] purrr_1.2.0                 xfun_0.54                  </span></span>
<span><span class="co">#&gt;  [21] MultiAssayExperiment_1.36.0 jsonlite_2.0.0             </span></span>
<span><span class="co">#&gt;  [23] progress_1.2.3              DelayedArray_0.36.0        </span></span>
<span><span class="co">#&gt;  [25] parallel_4.5.2              prettyunits_1.2.0          </span></span>
<span><span class="co">#&gt;  [27] cluster_2.1.8.1             R6_2.6.1                   </span></span>
<span><span class="co">#&gt;  [29] stringi_1.8.7               RColorBrewer_1.1-3         </span></span>
<span><span class="co">#&gt;  [31] limma_3.66.0                GenomicRanges_1.62.0       </span></span>
<span><span class="co">#&gt;  [33] Rcpp_1.1.0                  Seqinfo_1.0.0              </span></span>
<span><span class="co">#&gt;  [35] SummarizedExperiment_1.40.0 iterators_1.0.14           </span></span>
<span><span class="co">#&gt;  [37] knitr_1.50                  IRanges_2.44.0             </span></span>
<span><span class="co">#&gt;  [39] BiocBaseUtils_1.12.0        Matrix_1.7-4               </span></span>
<span><span class="co">#&gt;  [41] igraph_2.2.1                tidyselect_1.2.1           </span></span>
<span><span class="co">#&gt;  [43] abind_1.4-8                 yaml_2.3.10                </span></span>
<span><span class="co">#&gt;  [45] doParallel_1.0.17           codetools_0.2-20           </span></span>
<span><span class="co">#&gt;  [47] affy_1.88.0                 lattice_0.22-7             </span></span>
<span><span class="co">#&gt;  [49] tibble_3.3.0                plyr_1.8.9                 </span></span>
<span><span class="co">#&gt;  [51] Biobase_2.70.0              withr_3.0.2                </span></span>
<span><span class="co">#&gt;  [53] S7_0.2.0                    evaluate_1.0.5             </span></span>
<span><span class="co">#&gt;  [55] Spectra_1.20.0              pillar_1.11.1              </span></span>
<span><span class="co">#&gt;  [57] affyio_1.80.0               BiocManager_1.30.26        </span></span>
<span><span class="co">#&gt;  [59] MatrixGenerics_1.22.0       foreach_1.5.2              </span></span>
<span><span class="co">#&gt;  [61] stats4_4.5.2                MSnbase_2.36.0             </span></span>
<span><span class="co">#&gt;  [63] MALDIquant_1.22.3           ncdf4_1.24                 </span></span>
<span><span class="co">#&gt;  [65] generics_0.1.4              S4Vectors_0.48.0           </span></span>
<span><span class="co">#&gt;  [67] hms_1.1.4                   scales_1.4.0               </span></span>
<span><span class="co">#&gt;  [69] glue_1.8.0                  lazyeval_0.2.2             </span></span>
<span><span class="co">#&gt;  [71] tools_4.5.2                 mzID_1.48.0                </span></span>
<span><span class="co">#&gt;  [73] data.table_1.17.8           QFeatures_1.20.0           </span></span>
<span><span class="co">#&gt;  [75] vsn_3.78.0                  mzR_2.44.0                 </span></span>
<span><span class="co">#&gt;  [77] fs_1.6.6                    XML_3.99-0.20              </span></span>
<span><span class="co">#&gt;  [79] grid_4.5.2                  impute_1.84.0              </span></span>
<span><span class="co">#&gt;  [81] tidyr_1.3.1                 crosstalk_1.2.2            </span></span>
<span><span class="co">#&gt;  [83] MsCoreUtils_1.21.0          PSMatch_1.14.0             </span></span>
<span><span class="co">#&gt;  [85] cli_3.6.5                   viridisLite_0.4.2          </span></span>
<span><span class="co">#&gt;  [87] S4Arrays_1.10.0             dplyr_1.1.4                </span></span>
<span><span class="co">#&gt;  [89] AnnotationFilter_1.34.0     pcaMethods_2.2.0           </span></span>
<span><span class="co">#&gt;  [91] gtable_0.3.6                digest_0.6.37              </span></span>
<span><span class="co">#&gt;  [93] BiocGenerics_0.56.0         SparseArray_1.10.1         </span></span>
<span><span class="co">#&gt;  [95] htmlwidgets_1.6.4           farver_2.1.2               </span></span>
<span><span class="co">#&gt;  [97] htmltools_0.5.8.1           lifecycle_1.0.4            </span></span>
<span><span class="co">#&gt;  [99] httr_1.4.7                  statmod_1.5.1              </span></span>
<span><span class="co">#&gt; [101] MASS_7.3-65</span></span></code></pre></div>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Stanstrup Jan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
